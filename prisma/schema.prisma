generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Chain {
  id      Int    @id @default(autoincrement())
  name    String
  chainId Int    @unique @map("chain_id")

  @@map("chains")
}

model Block {
  id         Int    @id @default(autoincrement())
  chainId    Int    @map("chain_id")
  number     BigInt
  hash       String
  parentHash String @map("parent_hash")
  timestamp  Int

  @@unique([chainId, number])
  @@map("blocks")
}

model Transaction {
  id          Int     @id @default(autoincrement())
  chainId     Int     @map("chain_id")
  hash        String
  blockNumber BigInt  @map("block_number")
  from        String  @map("from")
  to          String? @map("to")
  value       Decimal
  status      Int?

  @@unique([chainId, hash])
  @@map("transactions")
}

model Log {
  id          Int    @id @default(autoincrement())
  chainId     Int    @map("chain_id")
  txHash      String @map("tx_hash")
  logIndex    Int    @map("log_index")
  blockNumber BigInt @map("block_number")
  address     String
  topic0      String? @map("topic0")
  topics      Json
  data        String

  @@unique([chainId, txHash, logIndex])
  @@map("logs")
}

model TokenTransfer {
  id          Int    @id @default(autoincrement())
  chainId     Int    @map("chain_id")
  txHash      String @map("tx_hash")
  logIndex    Int    @map("log_index")
  blockNumber BigInt @map("block_number")
  token       String
  from        String @map("from")
  to          String @map("to")
  amountRaw   Decimal @map("amount_raw")
  amountDec   String @map("amount_dec")
  timestamp   Int

  @@unique([chainId, txHash, logIndex])
  @@map("token_transfers")
}

model Swap {
  id           Int    @id @default(autoincrement())
  chainId      Int    @map("chain_id")
  txHash       String @map("tx_hash")
  logIndex     Int    @map("log_index")
  blockNumber  BigInt @map("block_number")
  dex          String
  pool         String
  trader       String?
  tokenIn      String @map("token_in")
  tokenOut     String @map("token_out")
  amountInRaw  Decimal @map("amount_in_raw")
  amountOutRaw Decimal @map("amount_out_raw")
  amountInDec  String @map("amount_in_dec")
  amountOutDec String @map("amount_out_dec")
  usdValue     Decimal? @map("usd_value")
  priced       Boolean @default(false)
  timestamp    Int

  @@unique([chainId, txHash, logIndex])
  @@map("swaps")
}

model Token {
  id       Int    @id @default(autoincrement())
  chainId  Int    @map("chain_id")
  address  String
  symbol   String
  decimals Int
  name     String
  firstSeenBlock BigInt? @map("first_seen_block")
  firstSeenAt    DateTime? @map("first_seen_at")
  verified Boolean @default(false)

  @@unique([chainId, address])
  @@map("tokens")
}

model Price {
  id              Int     @id @default(autoincrement())
  chainId         Int     @map("chain_id")
  token           String
  timestampMinute Int     @map("timestamp_minute")
  priceUsd        Decimal @map("price_usd")

  @@unique([chainId, token, timestampMinute])
  @@map("prices")
}

model WalletPosition {
  id         Int      @id @default(autoincrement())
  chainId    Int      @map("chain_id")
  wallet     String
  token      String
  balanceRaw Decimal  @map("balance_raw")
  balanceDec String   @map("balance_dec")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@unique([chainId, wallet, token])
  @@map("wallet_positions")
}

model WalletTokenPnl {
  id                 Int      @id @default(autoincrement())
  chainId            Int      @map("chain_id")
  wallet             String
  token              String
  realizedPnlUsd30d  Decimal  @map("realized_pnl_usd_30d")
  realizedPnlUsdAll  Decimal  @map("realized_pnl_usd_all")
  winTrades30d       Int      @map("win_trades_30d")
  lossTrades30d      Int      @map("loss_trades_30d")
  avgHoldSeconds30d  Int      @map("avg_hold_seconds_30d")
  updatedAt          DateTime @updatedAt @map("updated_at")

  @@unique([chainId, wallet, token])
  @@map("wallet_token_pnl")
}

model WalletScore {
  id          Int      @id @default(autoincrement())
  chainId     Int      @map("chain_id")
  wallet      String
  window      String
  score       Int
  featuresJson Json    @map("features_json")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@unique([chainId, wallet, window])
  @@map("wallet_scores")
}

model Label {
  id       Int    @id @default(autoincrement())
  label    String @unique
  category String

  @@map("labels")
}

model AddressLabel {
  id         Int      @id @default(autoincrement())
  chainId    Int      @map("chain_id")
  address    String
  labelId    Int      @map("label_id")
  confidence Decimal
  source     String
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@unique([chainId, address, labelId])
  @@map("address_labels")
}

enum IncentiveStatus {
  EARLY
  ACTIVE
  SATURATED
  ENDING
}

enum RewardAssetType {
  TOKEN
  POINTS
  FEES
}

enum CapitalRequirement {
  NONE
  LOW
  MED
  HIGH
}

enum TimeIntensity {
  PASSIVE
  SEMI
  ACTIVE
}

enum LinkTier {
  TIER1
  TIER2
  TIER3
}

enum LinkType {
  APP
  BRIDGE
  DEX
  DOCS
  SNAPSHOT
  REFERRAL
  FORUM
  GUIDE
  BLOG
  DASHBOARD
  EXPLORER
  OTHER
}

model Project {
  id          Int       @id @default(autoincrement())
  name        String
  slug        String    @unique
  description String?
  raise       String?
  website     String?
  logoUrl     String?   @map("logo_url")
  chains      String[]
  tags        String[]
  archived    Boolean   @default(false)
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  incentives  Incentive[]
  links       ProjectLink[]

  @@map("projects")
}

model ProjectLink {
  id        Int      @id @default(autoincrement())
  projectId Int      @map("project_id")
  tier      LinkTier
  type      LinkType
  label     String
  url       String
  createdAt DateTime @default(now()) @map("created_at")

  project Project @relation(fields: [projectId], references: [id])

  @@map("project_links")
}

model Incentive {
  id               Int              @id @default(autoincrement())
  projectId        Int              @map("project_id")
  title            String?
  description      String?
  status           IncentiveStatus
  types            String[]
  defillamaSlug    String?          @map("defillama_slug")
  rewardAssetType  RewardAssetType  @map("reward_asset_type")
  rewardAssetSymbol String?         @map("reward_asset_symbol")
  rewardAssets     String?          @map("reward_assets")
  rewardAssetAddress String?        @map("reward_asset_address")
  rewardAssetChain  String?         @map("reward_asset_chain")
  capitalRequired  CapitalRequirement @map("capital_required")
  timeIntensity    TimeIntensity    @map("time_intensity")
  riskFlags        String[]
  riskScore        Int?             @map("risk_score")
  saturationScore  Int?             @map("saturation_score")
  roiLabel         String?          @map("roi_label")
  effortLabel      String?          @map("effort_label")
  flowSummary      String?          @map("flow_summary")
  statusRationale  String?          @map("status_rationale")
  howToExtract     String?          @map("how_to_extract")
  xHandleUrl       String?          @map("x_handle_url")
  participationUrl String?          @map("participation_url")
  snapshotWindow   String?          @map("snapshot_window")
  verified         Boolean          @default(false)
  startAt          DateTime?        @map("start_at")
  endAt            DateTime?        @map("end_at")
  lastUpdatedAt    DateTime         @map("last_updated_at")
  createdAt        DateTime         @default(now()) @map("created_at")
  updatedAt        DateTime         @updatedAt @map("updated_at")

  project          Project          @relation(fields: [projectId], references: [id])
  events           IncentiveEvent[]
  links            IncentiveLink[]
  proofs           IncentiveProof[]
  metrics          IncentiveMetric?

  @@map("incentives")
}

model IncentiveEvent {
  id          Int      @id @default(autoincrement())
  incentiveId Int      @map("incentive_id")
  title       String
  detail      String?
  eventType   String   @map("event_type")
  effectiveAt DateTime @map("effective_at")
  createdAt   DateTime @default(now()) @map("created_at")

  incentive Incentive @relation(fields: [incentiveId], references: [id])

  @@map("incentive_events")
}

model IncentiveLink {
  id          Int      @id @default(autoincrement())
  incentiveId Int      @map("incentive_id")
  type        LinkType
  label       String
  url         String
  tier        LinkTier?
  createdAt   DateTime @default(now()) @map("created_at")

  incentive Incentive @relation(fields: [incentiveId], references: [id])

  @@map("incentive_links")
}

model IncentiveProof {
  id          Int      @id @default(autoincrement())
  incentiveId Int      @map("incentive_id")
  proofType   String   @map("proof_type")
  label       String
  url         String
  chain       String?
  createdAt   DateTime @default(now()) @map("created_at")

  incentive Incentive @relation(fields: [incentiveId], references: [id])

  @@map("incentive_proofs")
}

model IncentiveMetric {
  id               Int      @id @default(autoincrement())
  incentiveId      Int      @unique @map("incentive_id")
  tvlUsd           Decimal? @map("tvl_usd")
  volumeUsd24h     Decimal? @map("volume_usd_24h")
  updatedAt        DateTime @updatedAt @map("updated_at")

  incentive Incentive @relation(fields: [incentiveId], references: [id])

  @@map("incentive_metrics")
}

model DataSource {
  id           Int      @id @default(autoincrement())
  name         String
  tier         LinkTier
  url          String?
  ingestionType String  @map("ingestion_type")
  lastSeenAt   DateTime? @map("last_seen_at")
  createdAt    DateTime @default(now()) @map("created_at")

  @@map("data_sources")
}
